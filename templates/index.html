<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}SMIS LLM{% endblock %}</title>

  <meta name="robots" content="index, follow">
  <meta name="google-site-verification" content="X5v9TojsnrGEhmzB4bQDfjDVm_2ACl6F8Xk9LdAqJng" />

  <!-- å»ºè­°åŠ ä¸Šç¶²é æè¿° -->

  <meta name="description" content="SMIS LLM - å°ˆç‚ºç´¡ç¹”æ¥­è€…è¨­è¨ˆçš„AIå¹³å°ï¼Œæä¾›å³æ™‚æŸ¥è©¢èˆ‡åˆ†æï¼Œå¹«åŠ©æ‚¨å¿«é€Ÿç²å–å¸‚å ´è³‡è¨Šã€‚">

  <!-- Facebookã€LINEã€ç¤¾ç¾¤åˆ†äº«æ™‚ç”¨çš„è³‡è¨Š -->
  <meta property="og:title" content="SMIS LLM - å°ˆç‚ºç´¡ç¹”æ¥­è€…è¨­è¨ˆçš„AIå¹³å°">

  <meta property="og:description" content="SMIS LLM æä¾›ç´¡ç¹”æ¥­è€…å³æ™‚æŸ¥è©¢èˆ‡åˆ†æï¼Œå¹«åŠ©æ‚¨å¿«é€Ÿç²å–å¸‚å ´è³‡è¨Šã€‚">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://thai-learning-platform.onrender.com/">
  <meta property="og:image" content="https://thai-learning-platform.onrender.com/static/og-image.png"> <!-- è‹¥æœ‰ LOGO åœ–å¯æ”¾é€™ -->

  <!-- Twitter å¡ç‰‡è³‡è¨Šï¼ˆé¸ç”¨ï¼‰ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="SMIS LLM - å°ˆç‚ºç´¡ç¹”æ¥­è€…è¨­è¨ˆçš„AIå¹³å°">
  <meta name="twitter:description" content="SMIS LLM æä¾›ç´¡ç¹”æ¥­è€…å³æ™‚æŸ¥è©¢èˆ‡åˆ†æï¼Œå¹«åŠ©æ‚¨å¿«é€Ÿç²å–å¸‚å ´è³‡è¨Šã€‚">
    gtag('config', 'G-QJB4DL5LQQ');
  </script>

  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden; /* ç¦æ­¢æ»¾å‹•æ¢ */
    }
    :root {
      --top-area-height: 6rem; /* æ ¹æ“šå¯¦éš› top å€åŸŸé«˜åº¦èª¿æ•´ */
      --bottom-bar-height: 5rem; /* æ ¹æ“šå¯¦éš› search bar é«˜åº¦èª¿æ•´ */
    }
    body {
      font-family: 'Noto Sans TC', 'Sarabun', sans-serif;
      background-color: #f3f4f6; /* æ·ºç°èƒŒæ™¯ */
      color: #374151; /* ç°é»‘å­—è‰² */
      margin: 0;
      min-height: 100vh;
      /* display: flex;  ç§»é™¤ï¼Œé¿å… .top-logo å’Œ .main-container è¢«èª¤è§£ç‚º flex å·¦å³æ’ç‰ˆ */
    }
    /* Fixed top logo */
    .top-logo {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 48px;
      background-color: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      z-index: 1200;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 24px;
      color: #374151;
      user-select: none;
      padding: 0 12px;
      box-sizing: border-box;
    }
    .top-logo .hamburger {
      position: absolute;
      top: 8px;
      left: 12px;
      margin-right: 0;
      transform: none;
    }
    .top-logo-inner {
      display: flex;
      align-items: center;
      width: 100%;
      position: relative;
      max-width: 600px;
      justify-content: center;
    }
    .logo-text {
      margin: 0 auto;
    }
    /* Sidebar */
    .sidebar {
      position: fixed;
      top: 48px;
      left: 0;
      height: calc(100vh - 48px);
      width: 240px;
      background-color: #ffffff;
      border-right: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      /* ç§»é™¤ justify-content: space-between; ä½¿å…§å®¹ç·Šå¯†å †ç–Š */
      padding-top: 48px;
      box-sizing: border-box;
      z-index: 1000;
      transform: translateX(-100%);
      transition: transform 0.3s ease-in-out;
      overflow-y: auto;
    }
    .sidebar.open {
      transform: translateX(0);
    }
    /* Hamburger menu */
    .hamburger {
      width: 32px;
      height: 32px;
      z-index: 1300;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      padding: 4px 0;
      background: transparent;
      border: none;
      flex-shrink: 0;
    }
    .hamburger span {
      display: block;
      height: 3px;
      background-color: #1f2937 !important; /* æ·±ç°è‰²æ©«æ¢ï¼Œä½¿ç”¨ !important ç¢ºä¿ä¸è¢«è¦†è“‹ */
      border-radius: 2px;
      transition: background-color 0.2s;
    }
    .hamburger:hover span {
      background-color: #f97316 !important; /* æ©˜è‰² hover æ•ˆæœï¼Œä½¿ç”¨ !important */
    }
    /* Sidebar nav links */
    /* ç§»é™¤ .sidebar nav ç›¸é—œæ¨£å¼ */
    /* Main container */
    .main-container {
      max-width: 1200px;
      width: 100%;
      margin: 32px auto 0 auto; /* ä¸Šé‚Šè·32pxï¼Œå·¦å³è‡ªå‹•ç½®ä¸­ */
      transition: width 0.3s ease, margin-left 0.3s ease;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: calc(100vh - 48px); /* 100vh æ‰£æ‰ top-logo é«˜åº¦ */
      overflow: hidden; /* âœ… ä¸è®“æ•´é æ²å‹• */
      position: relative; /* âœ… è®“å­å±¤ absolute ä»¥æ­¤ç‚ºåŸºæº– */
    }
    .main-container.sidebar-open {
      width: calc(100% - 240px); /* âœ… å¯¬åº¦å¯¦éš›æ¸›å°‘ */
      margin-left: 240px; /* âœ… ä¸¦å‘å³æ¨ sidebar å¯¬åº¦ */
    }
    /* Remove top-header flex justify-content */
    .top-header {
      display: flex;
      justify-content: flex-start;
      align-items: center;
    }
    /* Hide menu */
    .menu {
      display: none;
    }
    /* Center block: title, subtitle, search */
    .center-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      text-align: center;
      align-self: center;
      width: 100%;
    }
    .main-title {
      font-size: 36px;
      font-weight: 700;
      color: #111827;
      user-select: none;
    }
    .sub-title {
      font-size: 18px;
      font-weight: 500;
      color: #6b7280;
      user-select: none;
    }
    .chat-interface {
      flex: 1;
      overflow-y: auto;
      padding-bottom: 60px; /* âœ… é ç•™åº•éƒ¨ç©ºé–“é¿å…è¢«æœå°‹æ¬„è“‹ä½ */
      margin-bottom: 16px;  /* âœ… å¢åŠ èˆ‡ search bar çš„è·é›¢ */
    }
    .search-container {
      position: absolute;
      bottom: 12px;
      left: 0;
      right: 0;
      width: 100%;
      max-width: 100%;
      padding-left: calc((100% - 960px) / 2);
      padding-right: calc((100% - 960px) / 2);
      padding-top: 12px;
      padding-bottom: 12px;
      z-index: 10;
      margin: 0;
    }

    .zoomable-img {
      cursor: zoom-in;
      transition: transform 0.3s ease;
    }

    .zoom-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 2000;
    }

    .zoom-overlay img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 8px;
    }

    /* å…¶ä»–æ¨£å¼ */
    .hidden {
      display: none;
    }
    
    @media (max-width: 767px) {
      .search-container {
        /* æ‰‹æ©Ÿç‰ˆç¶­æŒç¾æœ‰è¨­å®š */
        position: fixed;
        bottom: 12px;
        left: 0;
        right: 0;
        margin: 0 auto;
        padding: 0 16px;
        max-width: 600px;
        z-index: 10;
      }
    }
    .search-input {
      flex-grow: 1;
      padding: 10px 16px;
      font-size: 16px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      outline-offset: 2px;
      transition: border-color 0.2s ease-in-out;
    }
    .search-input:focus {
      border-color: #f97316;
      outline: none;
      box-shadow: 0 0 0 3px rgb(249 115 22 / 0.3);
    }
    .search-button {
      background-color: #f97316;
      color: white;
      font-weight: 600;
      padding: 0 20px;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease-in-out;
      border: none;
      font-size: 16px;
    }
    .search-button:hover {
      background-color: #ea580c;
    }
    /* Recommended questions cards grid */
    .recommended-questions {
      display: grid;
      grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
      gap: 24px;
      max-width: 960px;
      margin: 0 auto;
    }

    /* èª¿æ•´æ¨è–¦å•é¡Œå€å¡Šèˆ‡æœå°‹æ¬„çš„é–“è·ï¼Œè®“å¡ç‰‡ç·Šè²¼æœå°‹æ¬„ */
    #recommendation-section {
      margin-bottom: 0 !important;
    }
    .question-card {
      background-color: #f9fafb;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgb(0 0 0 / 0.1);
      cursor: pointer;
      transition: box-shadow 0.2s ease-in-out;
      font-size: 16px;
      color: #374151;
      font-weight: 500;
      user-select: none;
    }
    .question-card:hover {
      box-shadow: 0 4px 12px rgb(249 115 22 / 0.15);
      background-color: #fff7ed;
      color: #f97316;
    }

    /* æ¡Œæ©Ÿç‰ˆå¡ç‰‡æ’ç‰ˆï¼ˆå¯¬åº¦èˆ‡ç½®ä¸­ï¼‰ */
    @media (min-width: 768px) {
      /* é‡å°åŒ…è¦†å¡ç‰‡çš„çˆ¶å±¤ï¼ˆ.card-container æˆ– .recommended-questionsï¼‰åšæ°´å¹³ç½®ä¸­èˆ‡é–“è·è¨­å®š */
      .recommended-questions,
      .card-container {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: nowrap;
      }
      .question-card {
        width: 30%;
        min-width: 250px;
      }
    }

    #history-list-container {
      flex-grow: 1;
      overflow-y: auto;
      padding: 0.5rem;
      margin-top: 0;
    }

    @media (max-width: 767px) {
      .sidebar {
        width: 200px;
        height: calc(100vh - 48px);
        top: 48px;
      }
      .main-container {
        margin-left: 0;
        width: 100%;
        margin-top: 32px;
      }
      .recommended-questions {
        padding-left: 16px;
        padding-right: 16px;
        gap: 24px;
        grid-template-columns: 1fr;
      }
    }
    .typing-dots span {
      display: inline-block;
      font-size: 24px;
      animation: blink 1.4s infinite;
    }

    .typing-dots span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-dots span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes blink {
      0% { opacity: 0.2; }
      20% { opacity: 1; }
      100% { opacity: 0.2; }
    }
    /* --- æ–°å¢ chat-container éŸ¿æ‡‰å¼å¯¬åº¦èˆ‡ç½®ä¸­æ¨£å¼ --- */
    /* Markdown æ¨£å¼è¡¨æ ¼ */
    .markdown-table {
      border-collapse: collapse;
      width: 100%;
      max-width: 600px;
      margin-top: 12px;
      font-size: 14px;
    }
    .markdown-table th,
    .markdown-table td {
      border: 1px solid #ccc;
      padding: 6px 12px;
      text-align: center;
    }
    .markdown-table th {
      background-color: #f97316;
      color: white;
    }
    .chat-container {
      position: relative;
      width: 100%;
      height: calc(100vh - 48px - 80px); /* æ‰£æ‰ top-logo é«˜åº¦ */
      max-width: 960px;
      margin-left: 0;
      margin-right: 0;
      transition: margin-left 0.3s ease, transform 0.3s ease;
      overflow: hidden; /* ç¦æ­¢æ»¾å‹•æ¢ */
      /* å…¶ä»–é«˜åº¦äº¤ç”±çˆ¶å±¤æ§åˆ¶ */
    }
    .main-container.sidebar-open .chat-container {
      margin: 0 auto; /* ä¸­å¤®å°é½Š */
    }
  </style>
</head>
<body>
  <div class="top-logo" aria-label="Brand Logo" onclick="window.location.href='/'" style="cursor: pointer;">
    <button class="hamburger" aria-label="Toggle sidebar" aria-expanded="false" aria-controls="sidebar">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <div class="top-logo-inner">
      <a href="/" class="logo-text">
        <img src="/static/images/smis-logo.png" alt="SMIS Logo" style="height: 32px;">
      </a>
    </div>
  </div>

    <aside id="sidebar" class="sidebar" role="navigation" aria-label="Sidebar navigation" style="display:flex; flex-direction:column;">

      <section id="history-list-container">
        <h3 style="font-weight:600; margin-bottom:0.5rem;">æŸ¥è©¢ç´€éŒ„</h3>
        <ul id="history-list" style="list-style:none; padding-left:0; margin:0;">
          <!-- å‹•æ…‹æ’å…¥æ­·å²ç´€éŒ„ -->
        </ul>
      </section>

      <div id="user-profile" style="padding: 12px 24px; border-top: 1px solid #e5e7eb; display: flex; align-items: center; gap: 12px;">
        <div style="width: 40px; height: 40px; border-radius: 50%; background-color: #f97316;"></div>
        <div style="font-weight: 600; color: #374151;">User Name</div>
      </div>
    </aside>

  <main id="main-content" class="main-container" role="main">
    <!-- Top header -->
    <header class="top-header">
    </header>

    <!-- æ–°å¢ chat-container å¤–å±¤ï¼ŒåŒ…ä½èŠå¤©å€èˆ‡æœå°‹æ¬„ -->
    <div class="chat-container flex flex-col flex-1 min-h-0 w-full max-w-2xl mx-auto px-4"
         style="height: calc(100vh - 48px); position: relative;"> <!-- 48px æ˜¯ top-logo é«˜åº¦ -->
      <!-- Center block -->
      <section class="center-block mb-4" aria-labelledby="main-title">
        <h1 id="main-title" class="main-title">SMIS LLM</h1>
      </section>

      <!-- Recommended questions cards -->
      <div id="recommendation-section" class="flex flex-col items-center space-y-4">
        <div class="flex flex-col md:flex-row justify-center gap-4">
          <div class="question-card" tabindex="0">2024 å¹´ Nike çš„é‹å‹•ç¨®é¡åˆ†å¸ƒç‚ºä½•ï¼Ÿ</div>
          <div class="question-card" tabindex="0">Under Armour æ–¼ 2022ï½2024 å¹´æ¨å‡ºçš„å•†å“ä¸­ï¼Œæ˜¯å¦ä»¥è¨“ç·´èˆ‡å¥èº«é¡åˆ¥ç‚ºä¸»ï¼Ÿ</div>
          <div class="question-card" tabindex="0">Alo Yoga æ–¼ 2022ï½2024 å¹´æ˜¯å¦æŒçºŒæ“´å¤§ç‘œçˆé¡ç”¢å“é–‹ç™¼ï¼Ÿ</div>
        </div>
      </div>

      <!-- Chat Interface -->
      <section id="chat-interface" class="flex flex-col flex-1 overflow-y-auto gap-4 pb-[60px]">
        <div id="chat-history" class="flex flex-col overflow-y-auto px-4 py-4 space-y-4 min-h-[200px]"></div>
        <!-- èŠå¤©è¨Šæ¯æœƒæ’å…¥é€™è£¡ -->
      </section>
      
      <!-- å…§åµŒæœå°‹æ¬„ï¼ˆéå›ºå®šï¼‰ -->
      <div id="search-container" class="search-container">
        <form id="chat-form" class="w-full flex gap-2" onsubmit="handleChatSubmit(event);">
          <input type="text" id="chat-input" placeholder="è¼¸å…¥ä½ çš„å•é¡Œ..." class="flex-1 border border-gray-300 rounded-l px-4 py-2 focus:outline-none" required />
          <button type="submit" class="bg-orange-400 hover:bg-orange-500 text-white px-4 py-2 rounded-r">é€å‡º</button>
        </form>
      </div>
    </div>
  </main> 


  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const hamburger = document.querySelector('.hamburger');
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('main-content');
      const chatArea = document.getElementById('chat-interface');

      hamburger.addEventListener('click', (event) => {
        event.stopPropagation();
        const isOpen = sidebar.classList.toggle('open');
        if (isOpen) {
          hamburger.setAttribute('aria-expanded', 'true');
          mainContent.classList.add('sidebar-open');
        } else {
          hamburger.setAttribute('aria-expanded', 'false');
          mainContent.classList.remove('sidebar-open');
        }
      });

      document.addEventListener('click', (e) => {
        if (!sidebar.contains(e.target) && !hamburger.contains(e.target) && sidebar.classList.contains('open')) {
          sidebar.classList.remove('open');
          hamburger.setAttribute('aria-expanded', 'false');
          mainContent.classList.remove('sidebar-open');
        }
      });

      // menuChat ç›¸é—œäº‹ä»¶å·²ç§»é™¤ï¼ˆå› ç‚ºå·²ç„¡ menuChat å…ƒç´ ï¼‰

      // æ¨¡æ“¬æŸ¥è©¢ç´€éŒ„è³‡æ–™
      const histories = [
        {
          id: 1,
          title: '2024å¹´Nikeé‹å‹•ç¨®é¡åˆ†å¸ƒ',
          messages: [
            { role: 'user', text: '2024å¹´Nikeé‹å‹•ç¨®é¡åˆ†å¸ƒç‚ºä½•ï¼Ÿ' },
            { role: 'assistant', text: 'MOCK_ANALYSIS_1' },
          ]
        },
        {
          id: 2,
          title: 'Under Armouråˆ†æ',
          messages: [
            { role: 'user', text: 'Under Armour 2022-2024å•†å“åˆ†æ' },
            { role: 'assistant', text: 'MOCK_ANALYSIS_UA_CHART' },
          ]
        },
        {
          id: 3,
          title: 'SMIS LLM åŠŸèƒ½',
          messages: [
            { role: 'user', text: 'SMIS LLM çš„åŠŸèƒ½æ˜¯ä»€éº¼' },
            { role: 'assistant', text: 'èªªæ˜ SMIS GPT çš„åŠŸèƒ½' },
            { role: 'user', text: 'ä½ èªªæ˜å•Š' },
            { role: 'assistant', text: 'SMIS GPTæ˜¯ä¸€å¥—ç”¢æ¥­æ•¸æ“šåˆ†æåŠ©æ‰‹ï¼Œæ”¯æ´è‡ªç„¶èªè¨€æå•ã€‚ä½¿ç”¨è€…åªéœ€è¦è¼¸å…¥å•é¡Œï¼Œä¾‹å¦‚ã€ŒNikeé€™ä¸‰å¹´æœ€ç†±é–€çš„å“é …æ˜¯ä»€éº¼ï¼Ÿã€ç­‰ï¼Œç³»çµ±æœƒè‡ªå‹•åˆ†æè³‡æ–™ä¸¦ç”¢å‡ºåœ–è¡¨èˆ‡çµ±è¨ˆæ‘˜è¦ï¼Œå¹«åŠ©ç”¨æˆ¶å¿«é€Ÿç†è§£ç›¸é—œç”¢æ¥­å‹•æ…‹èˆ‡è¶¨å‹¢ã€‚' },
          ]
        }
      ];

      // è¼‰å…¥æ­·å²ç´€éŒ„åˆ—è¡¨
      function loadHistoryList() {
        const historyList = document.getElementById('history-list');
        if (!historyList) return;
        historyList.innerHTML = '';
        histories.forEach(h => {
          const li = document.createElement('li');
          li.textContent = h.title;
          li.style.cursor = 'pointer';
          li.style.padding = '6px 8px';
          li.style.borderRadius = '4px';
          li.addEventListener('click', () => {
            loadChatHistory(h.messages);
            chatArea.style.display = 'flex';
            // æ–°å¢ï¼šæ‰‹æ©Ÿå¯¬åº¦æ™‚æ”¶èµ·å´é‚Šæ¬„
            if (window.innerWidth <= 767) {
              sidebar.classList.remove('open');
              hamburger.setAttribute('aria-expanded', 'false');
              mainContent.classList.remove('sidebar-open');
            }
          });
          li.addEventListener('mouseenter', () => li.style.backgroundColor = '#f97316');
          li.addEventListener('mouseleave', () => li.style.backgroundColor = 'transparent');
          historyList.appendChild(li);
        });
      }

      // è¼‰å…¥æŒ‡å®šæ­·å²èŠå¤©è¨Šæ¯åˆ°èŠå¤©å€
      function loadChatHistory(messages) {
        document.getElementById('recommendation-section').style.display = 'none';
        document.getElementById('main-title')?.classList.add('hidden');
        const container = document.getElementById('chat-history');
        container.innerHTML = '';
        messages.forEach(m => appendMessage(m.role, m.text));
      }

      function toggleTable(button) {
        const tableWrapper = button.nextElementSibling;
        const isHidden = tableWrapper.classList.contains('hidden');
        if (isHidden) {
          tableWrapper.classList.remove('hidden');
          button.innerText = 'â– æ”¶èµ·è©³ç´°è¡¨æ ¼';
        } else {
          tableWrapper.classList.add('hidden');
          button.innerText = 'â• é¡¯ç¤ºè©³ç´°è¡¨æ ¼';
        }
      }

      // appendMessage å‡½å¼æ²¿ç”¨ç¾æœ‰å®šç¾©

      // åˆå§‹è¼‰å…¥æ­·å²ç´€éŒ„
      loadHistoryList();
    });

    let loadingBubble = null;

    function showTypingAnimation() {
      const container = document.getElementById('chat-history');
      loadingBubble = document.createElement('div');
      loadingBubble.className = 'self-start bg-gray-200 text-left rounded-lg px-4 py-2 max-w-[80%] flex items-center';
      loadingBubble.innerHTML = '<span class="typing-dots"><span>.</span><span>.</span><span>.</span></span>';
      container.appendChild(loadingBubble);
    }

    function hideTypingAnimation() {
      if (loadingBubble) {
        loadingBubble.remove();
        loadingBubble = null;
      }
    }

    // æ¨¡æ“¬å›è¦†æµç¨‹
    async function handleChatSubmit() {
      showTypingAnimation();
      // ç­‰å¾…å›è¦†
      await new Promise(r => setTimeout(r, 500));
      hideTypingAnimation();
    }

    // --- Chat interface JS ---
    async function handleChatSubmit(event) {
      event.preventDefault();
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      if (!message) return;

      // éš±è—æ¨è–¦å•é¡Œå€èˆ‡æ¨™é¡Œ
      document.getElementById('recommendation-section').style.display = 'none';
      document.getElementById('main-title')?.classList.add('hidden');
      document.getElementById('sub-title')?.classList.add('hidden');

      appendMessage('user', message);
      showTypingAnimation();
      input.value = '';

      let replies = [];

      if (message.includes('Nike')) {
        replies = ['MOCK_ANALYSIS_1'];
      } else if (message.includes('Under Armour')) {
        replies = ['MOCK_ANALYSIS_UA_TEXT', 'MOCK_ANALYSIS_UA_CHART'];
      } else if (message.includes('Alo Yoga')) {
        replies = ['MOCK_ANALYSIS_ALO_TEXT', 'MOCK_ANALYSIS_ALO_CHART'];
      } else if (message.includes('adidas')) {
        replies = ['MOCK_ANALYSIS_ADIDAS_TEXT', 'MOCK_ANALYSIS_ADIDAS_CHART'];
      } else {
        replies = ['MOCK_ANALYSIS_DEFAULT'];
      }

      for (let i = 0; i < replies.length; i++) {
        await new Promise(resolve => setTimeout(resolve, 700));
        appendMessage('assistant', replies[i]);
      }

      hideTypingAnimation();
    }

    // --- æ–°ç‰ˆ appendMessage åŠæ¨è–¦å•é¡Œå¡ç‰‡äº‹ä»¶ ---
    function appendMessage(role, text) {
      const container = document.getElementById('chat-history');
      const bubble = document.createElement('div');

      if (role === 'user') {
        bubble.className = 'self-end bg-orange-100 text-left rounded-lg px-4 py-2 max-w-[80%]';
        bubble.innerText = text;
        container.appendChild(bubble);
      } else if (role === 'assistant' || role === 'system') {
        bubble.className = 'self-start bg-gray-200 text-left rounded-lg px-4 py-2 max-w-[80%]';

        // å…¶ä»–åŸæœ‰æ–‡å­—å’Œåœ–è¡¨åˆ¤æ–·...
        switch(text) {
          case 'MOCK_ANALYSIS_1':
            {
              // ç³»çµ±èªªæ˜æ³¡æ³¡
              const systemBubble = document.createElement('div');
              systemBubble.className = 'self-start bg-gray-200 text-left rounded-lg px-4 py-2 max-w-[80%]';
              systemBubble.innerText = `æ ¹æ“šSMISè³‡æ–™åº«2024å¹´çš„æ•¸æ“šé¡¯ç¤ºï¼ŒNikeåœ¨2024å¹´åº¦çš„é‹å‹•å•†å“ç¨®é¡ä¸»è¦é›†ä¸­æ–¼ä»¥ä¸‹å¹¾å€‹æ–¹é¢ï¼Œé …ç›®æ¯”ä¾‹åˆ†æå¦‚ä¸‹ï¼š

1. ä¼‘é–’èˆ‡ç”Ÿæ´»é¢¨æ ¼é¡ç”¢å“ ï¼ˆLifestyleï¼‰ï¼šä½”æ¯”æœ€é«˜ï¼Œé”åˆ°ç´„31.7%ï¼Œå…±è¨ˆ6,532ä»¶ï¼Œé¡¯ç¤ºNikeåœ¨ç”Ÿæ´»ä¼‘é–’é¡ç”¢å“çš„å¸‚å ´å¸ƒå±€ä½”æœ‰é‡è¦ä½ç½®ã€‚
2. é«”è‚²å°ˆé …é‹å‹•ï¼š
- è¶³çƒï¼è¶³çƒï¼ˆFootball/Soccerï¼‰ï¼šä½”æ¯”ç´„14.7%ï¼Œå…±è¨ˆ3,019ä»¶ã€‚
- è·‘æ­¥ï¼ˆRunningï¼‰ï¼šä½”æ¯”ç´„4.3%ï¼Œå…±è¨ˆ892ä»¶ã€‚
- è¨“ç·´èˆ‡å¥èº«ï¼ˆTraining & Gymï¼‰ï¼šä½”æ¯”ç´„9.2%ï¼Œå…±è¨ˆ1,889ä»¶ã€‚
3. å…¶ä»–é‹å‹•é¡åˆ¥å¦‚ï¼š
- æ©„æ¬–çƒï¼ˆRugbyï¼‰ï¼šç´„0.03%
- é«”æ“ï¼ˆDanceï¼‰ï¼šç´„0.8%
- æ¸¸æ³³ï¼ˆSwimï¼‰ï¼šç´„1.2%
- é«˜çˆ¾å¤«ï¼ˆGolfï¼‰ï¼šç´„2.8%
- æ»‘æ¿ï¼Skateboardingï¼šç´„0.7%
- æ»‘é›ªèˆ‡é›ªæ¿ï¼ˆSki & Snowboardï¼‰ï¼šç´„0.09%
- æ½›æ°´ï¼ˆDivingï¼‰ã€é‡£é­šï¼ˆFishingï¼‰ã€æ¯”è³½ç”¨æœï¼ˆCombat/MMAï¼‰ç­‰æ¯”ä¾‹è¼ƒå°ï¼Œéƒ½åœ¨0.04%è‡³0.2%ä¹‹é–“ã€‚

æ•´é«”ä¾†çœ‹ï¼ŒNikeçš„ç”¢å“ç¨®é¡åœ¨2024å¹´ä¸­ï¼ŒLifestyleåŠè¶³çƒã€è¨“ç·´ã€è·‘æ­¥çš„ç”¢å“æœ€ç‚ºè±å¯Œï¼Œå æ“šå¤§éƒ¨åˆ†å¸‚å ´ä»½é¡ï¼Œé¡¯ç¤ºå“ç‰Œåœ¨ä¼‘é–’ç”Ÿæ´»èˆ‡ä¸»æµé‹å‹•é ˜åŸŸçš„é‡é»å¸ƒå±€ã€‚

æ­¤å¤–ï¼Œè³‡æ–™åº«ä¸­æåŠçš„ç›¸é—œè¡Œæ¥­å‹•æ…‹ï¼Œå¦‚éç¹”é€ ææ–™æ‡‰ç”¨æ–¼é‹å‹•æœè£çš„å‰µæ–°ï¼Œä¹Ÿå¯èƒ½ä¿ƒä½¿NikeæŒçºŒæ‹“å±•åœ¨æ–°å‹ææ–™å’Œå¤šåŠŸèƒ½é‹å‹•ç”¢å“çš„ç ”ç™¼ï¼Œé€²ä¸€æ­¥è±å¯Œå•†å“ç¨®é¡ã€‚

è‹¥éœ€è¦é€²ä¸€æ­¥ç´°ç¯€åˆ†ææˆ–æœ‰å…¶ä»–é‹å‹•é¡åˆ¥çš„ç›¸é—œå•é¡Œï¼Œè«‹éš¨æ™‚å‘ŠçŸ¥ã€‚`;
              container.appendChild(systemBubble);

              bubble.className = 'self-start bg-gray-50 text-left rounded-lg px-4 py-2 max-w-[80%] mt-2';
              bubble.innerHTML = `
                <div class="mb-2 font-semibold">åˆ†æï¼š</div>
                <div class="text-sm mb-2">2024 å¹´ Nike å…±ä¸Šæ¶ 20,578 ä»¶å•†å“ã€‚æ ¹æ“šå•†å“åˆ†å¸ƒè³‡æ–™ï¼Œé‹å‹•é¡åˆ¥ä¸­ä½”æ¯”æœ€é«˜çš„æ˜¯ç”Ÿæ´»ä¼‘é–’ï¼ˆLifestyleï¼‰ï¼Œå•†å“æ•¸é‡é” 6,532 ä»¶ï¼Œå ç¸½æ•¸çš„ 31.74%ã€‚å…¶æ¬¡ç‚ºæ£’çƒï¼ˆBaseballï¼‰ï¼Œå•†å“æ•¸é‡ç‚º 3,641 ä»¶ï¼Œå  17.69%ï¼Œä»¥åŠå…¶ä»–é¡åˆ¥ï¼ˆOtherï¼‰ï¼Œå•†å“æ•¸é‡ç‚º 3,265 ä»¶ï¼Œå  15.87%ã€‚è¶³çƒï¼ˆFootball/Soccerï¼‰å•†å“æ•¸é‡ç‚º 3,019 ä»¶ï¼Œå  14.67%ã€‚è¨“ç·´èˆ‡å¥èº«ï¼ˆTraining & Gymï¼‰å•†å“ç‚º 1,889 ä»¶ï¼Œå  9.18%ã€‚ç±ƒçƒï¼ˆBasketballï¼‰åŠè·‘æ­¥ï¼ˆRunningï¼‰åˆ†åˆ¥ç‚º 1,340 ä»¶ï¼ˆ6.51%ï¼‰èˆ‡ 892 ä»¶ï¼ˆ4.33%ï¼‰ã€‚é™¤ä¸Šè¿°ä¸»è¦é‹å‹•å¤–ï¼Œå…¶ä»–é¡åˆ¥å¦‚é«˜çˆ¾å¤«ï¼ˆGolfï¼‰ã€å¾’æ­¥ï¼ˆHiking & Trailï¼‰ã€æ’çƒï¼ˆVolleyballï¼‰ç­‰å•†å“æ¯”ä¾‹è¼ƒä½ï¼Œçš†æœªè¶…é 1.5%ã€‚ç¸½é«”ä¾†çœ‹ï¼ŒNike åœ¨ 2024 å¹´çš„å•†å“é–‹ç™¼ç­–ç•¥é›†ä¸­æ–¼ä¼‘é–’èˆ‡çƒé¡é‹å‹•ï¼Œç‰¹åˆ¥æ˜¯ç”Ÿæ´»ä¼‘é–’ã€æ£’çƒèˆ‡è¶³çƒé¡åˆ¥ï¼Œåæ˜ å“ç‰Œåœ¨é€™äº›é‹å‹•å¸‚å ´çš„å¸ƒå±€é‡é»ã€‚</div>
                <img src="/static/images/nike_chart_sample.png" alt="ç¤ºæ„åœ–" class="rounded border border-gray-300 mb-4" />
                <div class="mb-2 font-semibold">åœ“é¤…åœ–è³‡æ–™è¡¨</div>
                <table class="markdown-table">
                  <thead>
                    <tr><th>é¡åˆ¥</th><th>æ•¸é‡</th><th>ç™¾åˆ†æ¯”</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Lifestyle</td><td>6532</td><td>31.74%</td></tr>
                    <tr><td>Baseball</td><td>3641</td><td>17.69%</td></tr>
                    <tr><td>Football</td><td>3019</td><td>14.67%</td></tr>
                    <tr><td>Training</td><td>1889</td><td>9.18%</td></tr>
                    <tr><td>Basketball</td><td>1340</td><td>6.51%</td></tr>
                    <tr><td>Running</td><td>892</td><td>4.33%</td></tr>
                  </tbody>
                </table>
              `;
              container.appendChild(bubble);
              // ç¶å®šåœ–ç‰‡æ”¾å¤§
              const img = bubble.querySelector('img');
              if (img) enableZoom(img);
              // æ’å…¥æŒ‰éˆ•åˆ—
              insertButtonRow(container, bubble, systemBubble);
              break;
            }
          case 'MOCK_ANALYSIS_UA_CHART':
            {
              // ç³»çµ±èªªæ˜æ³¡æ³¡
              const systemBubble = document.createElement('div');
              systemBubble.className = 'self-start bg-gray-200 text-left rounded-lg px-4 py-2 max-w-[80%]';
              systemBubble.innerText = `æ ¹æ“šSMISè³‡æ–™åº«æ‰€æä¾›çš„2022å¹´è‡³2024å¹´é–“Under Armourçš„å•†å“é¡åˆ¥æ•¸é‡åˆ†å¸ƒæ•¸æ“šï¼Œå¯ä»¥é€²è¡Œä»¥ä¸‹åˆ†æï¼š

ä¸€ã€2022å¹´ï¼š
- æœ€ä¸»è¦çš„å•†å“é¡åˆ¥ç‚ºã€Œè¨“ç·´èˆ‡å¥èº«ï¼ˆTraining & Gymï¼‰ã€é¡åˆ¥ï¼Œå…±è¨ˆ620ä»¶ï¼Œå æ¯”ç´„28.17%ï¼Œé é«˜æ–¼å…¶ä»–é¡åˆ¥ã€‚
- å…¶æ¬¡ç‚ºã€Œè·‘æ­¥ï¼ˆRunningï¼‰ã€é¡åˆ¥ï¼Œå…±è¨ˆ560ä»¶ï¼Œå æ¯”ç´„25.44%ã€‚
- ã€Œç±ƒçƒï¼ˆBasketballï¼‰ã€å’Œã€Œæ‹³æ“Šï¼ˆBoxingï¼‰ã€é¡åˆ¥æ•¸é‡å‡åœ¨12ä»¶èˆ‡206ä»¶å·¦å³ï¼Œä½†åœ¨æ•´é«”æ¯”é‡ä¸Šä¸åŠè¨“ç·´èˆ‡è·‘æ­¥ã€‚

äºŒã€2023å¹´ï¼š
- ã€Œè¨“ç·´èˆ‡å¥èº«ã€çš„å•†å“æ•¸é‡æŒçºŒæ”€å‡è‡³576ä»¶ï¼Œæ¯”ä¾‹ç´„ç‚º32.52%ï¼ŒåŒæ¨£æ˜¯æœ€å¤§é¡åˆ¥ã€‚
- ã€Œè·‘æ­¥ã€é¡åˆ¥ä¹Ÿç¶­æŒåœ¨é«˜ä½ï¼Œç´„383ä»¶ï¼Œå æ¯”ç´„21.63%ã€‚
- å…¶ä»–é¡åˆ¥å¦‚ã€Œç±ƒçƒã€å’Œã€Œæ‹³æ“Šã€äº¦å‘ˆå¢é•·è¶¨å‹¢ã€‚

ä¸‰ã€2024å¹´ï¼š
- ã€Œè¨“ç·´èˆ‡å¥èº«ã€çš„å•†å“ä»¶æ•¸é€²ä¸€æ­¥å¢è‡³1174ä»¶ï¼Œç´„ä½”æ¯”50.61%ï¼Œæ˜é¡¯ç‚ºæœ€å¤§å•†å“é¡åˆ¥ã€‚
- ã€Œè·‘æ­¥ã€é¡åˆ¥äº¦é¡¯è‘—å¢åŠ è‡³241ä»¶ï¼Œå æ¯”ç´„10.39%ï¼Œä½†é¡¯è‘—ä½æ–¼è¨“ç·´èˆ‡å¥èº«é¡åˆ¥ã€‚
- å…¶ä»–é¡åˆ¥ï¼Œå¦‚ã€Œç±ƒçƒã€å’Œã€Œæ‹³æ“Šã€çš„å•†å“æ•¸é‡è¼ƒå°‘ï¼Œæ•´é«”ä¸Šåœ¨å¤šå…ƒåŒ–åˆ†é¡ä¸­ï¼Œè¨“ç·´èˆ‡å¥èº«æŒçºŒæˆç‚ºé‡é»ã€‚

ã€çµè«–ã€‘ï¼š
å¾æ•¸æ“šå¯ä»¥æ˜ç¢ºçœ‹å‡ºï¼ŒUnder Armouråœ¨2022è‡³2024å¹´é–“ï¼Œå•†å“é¡åˆ¥ä¸­ã€Œè¨“ç·´èˆ‡å¥èº«ã€é¡åˆ¥çš„æ¯”ä¾‹é€å¹´å¢åŠ ï¼Œä¸”åœ¨2024å¹´å·²ç¶“è¶…éä¸€åŠçš„å•†å“æ•¸é‡ï¼Œæˆç‚ºæœ€å…·ä»£è¡¨æ€§çš„å•†å“é¡åˆ¥ã€‚é€™è¡¨æ˜Under Armourçš„ç”¢å“ç­–ç•¥é¡¯è‘—åå‘æ–¼è¨“ç·´èˆ‡å¥èº«é¡åˆ¥ï¼Œä¸¦å¯åˆ¤æ–·å…¶ä¸»è¦å¸‚å ´é‡å¿ƒç¢ºå¯¦é›†ä¸­åœ¨æ­¤ç¯„ç–‡ã€‚

è‡³æ–¼é‹å‹•é¡åˆ¥çš„ç´°åˆ†æ–¹é¢ï¼Œå°¤å…¶æ˜¯2024å¹´ï¼Œè¨“ç·´èˆ‡å¥èº«é¡åˆ¥å·²æ˜¯æœ€å¤§é¡åˆ¥ï¼Œé¡¯ç¤ºå…¶é‡é»åœ¨æ–¼æä¾›å°ˆç‚ºè¨“ç·´å’Œå¥èº«æ‰€è¨­è¨ˆçš„ç”¢å“ï¼Œæœ‰åŠ©æ–¼æ”¯æ´ç›¸é—œé‹å‹•é ˜åŸŸçš„éœ€æ±‚ã€‚

ã€WTiNç›¸é—œç²¾é¸æ‘˜éŒ„ã€‘ï¼š
"Smart sportswear are garments modified with electronic components to sense and monitor different parameters and provide valuable insights about the wearer... This information can be used to improve performance and reduce the risk of critical injuries."
æ­¤æ®µå…§å®¹å¼·èª¿æ™ºæ…§é‹å‹•æœè£çš„æ‡‰ç”¨ç¯„ç–‡èˆ‡è¨“ç·´å¥èº«å¯†åˆ‡ç›¸é—œï¼Œä½è­‰Under Armourå°ˆæ³¨æ–¼é‹å‹•æ€§èƒ½æå‡çš„ç­–ç•¥ã€‚

åŸå› èªªæ˜ï¼šæ­¤æ‘˜éŒ„å‡¸é¡¯äº†æ™ºæ…§é‹å‹•æœè£åœ¨æå‡é‹å‹•è¡¨ç¾å’Œå®‰å…¨ä¸Šçš„ä½œç”¨ï¼Œå‘¼æ‡‰Under Armouråœ¨è¨“ç·´å’Œå¥èº«å•†å“çš„é‡é»å¸ƒå±€ï¼Œå¾è€Œè£œå……åˆ†æçš„èƒŒæ™¯ç†ç”±ã€‚`;
              container.appendChild(systemBubble);

              const chartBubble = document.createElement('div');
              chartBubble.className = 'self-start bg-gray-50 text-left rounded-lg px-4 py-2 max-w-[80%] mt-2';
              chartBubble.innerHTML = `
                <div class="mb-2 font-semibold">åˆ†æï¼š</div>
                <div class="text-sm mb-2">2024 å¹´å…±ä¸Šæ¶ 2,320 ä»¶å•†å“ã€‚è¨“ç·´èˆ‡å¥èº«ï¼ˆTraining & Gymï¼‰é¡åˆ¥é–‹ç™¼ä»¶æ•¸é” 1,174 ä»¶ï¼Œä½”æ¯” 50.6%ï¼Œç‚ºå„é¡åˆ¥ä¸­ä»¶æ•¸æœ€å¤šçš„é …ç›®ï¼Œé¡¯ç¤ºå“ç‰Œåœ¨æ­¤é¡åˆ¥çš„ç”¢å“ç­–ç•¥ä¸ŠæŠ•å…¥è¼ƒé«˜ã€‚è·‘æ­¥ï¼ˆRunningï¼‰é¡åˆ¥å‰‡æœ‰ 241 ä»¶ï¼Œå æ¯” 10.4%ã€‚å…¶ä»–ä¸»è¦é¡åˆ¥åŒ…æ‹¬é«˜çˆ¾å¤«ï¼ˆGolfï¼‰186 ä»¶ï¼ˆ8.0%ï¼‰ã€é‡£é­šï¼ˆFishingï¼‰93 ä»¶ï¼ˆ4.0%ï¼‰å’Œç±ƒçƒï¼ˆBasketballï¼‰61 ä»¶ï¼ˆ2.6%ï¼‰ã€‚è¨“ç·´èˆ‡å¥èº«é¡åˆ¥çš„ä»¶æ•¸åœ¨ä¸‰å¹´æœŸé–“æŒçºŒç‚ºæœ€é«˜ï¼Œæ˜ç¢ºå±•ç¾å“ç‰Œåœ¨å•†å“é–‹ç™¼é‡é»ä¸Šçš„ç­–ç•¥æ–¹å‘ã€‚</div>
                <img src="/static/images/ua_chart_sample.png" alt="Under Armour 2022-2024 å¹´å„é‹å‹•é¡åˆ¥éŠ·å”®æ•¸é‡è¶¨å‹¢" class="rounded border border-gray-300" />
              `;
              container.appendChild(chartBubble);
              // ç¶å®šåœ–ç‰‡æ”¾å¤§
              const img = chartBubble.querySelector('img');
              if (img) enableZoom(img);
              insertButtonRow(container, chartBubble);
              break;
            }
          case 'MOCK_ANALYSIS_ALO_CHART':
            {
              // ç³»çµ±èªªæ˜æ³¡æ³¡
              const systemBubble = document.createElement('div');
              systemBubble.className = 'self-start bg-gray-200 text-left rounded-lg px-4 py-2 max-w-[80%]';
              systemBubble.innerText = `æ ¹æ“šSMISæ•¸æ“šé¡¯ç¤ºï¼ŒAlo Yogaå¾2022å¹´è‡³2024å¹´é–“ï¼Œç‘œçˆé¡ç”¢å“çš„å•†å“æ•¸é‡æ•´é«”å‘ˆç¾å‡ºæŒçºŒæ“´å¤§çš„è¶¨å‹¢ã€‚

å…·é«”åˆ†æå¦‚ä¸‹ï¼š
- 2022å¹´åˆï¼ŒAlo Yogaåœ¨2022å¹´1æœˆçš„ç‘œçˆç”¢å“æ•¸é‡ç‚º292ä»¶ï¼Œä½”å…¶ç¸½å•†å“çš„ç´„35.87%ã€‚è©²å¹´åº¦æ•´é«”å•†å“æ•¸é‡æ³¢å‹•ä½†å‘ˆç¾å‡ºå¢åŠ çš„è¶¨å‹¢ï¼Œå°¤å…¶åœ¨2022å¹´6æœˆé”åˆ°é«˜é»78ä»¶ï¼ˆç´„38.23%æ¯”ä¾‹ï¼‰ã€‚
- é€²å…¥2023å¹´ï¼Œå•†å“æ•¸é‡æŒçºŒæ³¢å‹•ï¼Œ2023å¹´7æœˆå†æ¬¡å‡ºç¾é«˜å³°ï¼ˆ66ä»¶ï¼Œå æ¯”ç´„38.15%ï¼‰ï¼Œä½†æ•´é«”å‘ˆç¾é€æ¼¸ä¸‹é™çš„è¶¨å‹¢ï¼Œå°¤å…¶åœ¨2023å¹´æœ«è‡³2024å¹´åˆï¼Œå•†å“æ•¸é‡æœ‰æ‰€ä¸‹é™ã€‚
- 2024å¹´èµ·ï¼Œå•†å“æ•¸é‡å†æ¬¡å‡ºç¾å¢é•·çš„è·¡è±¡ï¼Œå°¤å…¶åœ¨2024å¹´9æœˆé”åˆ°é«˜é»100ä»¶ï¼ˆç´„25.51%ï¼‰ï¼Œé¡¯ç¤ºAlo Yogaåœ¨2024å¹´ä¸‹åŠå¹´ï¼Œç‘œçˆç”¢å“æ•¸é‡æœ‰æ˜é¡¯çš„æå‡ã€‚

ç”±æ­¤å¯è¦‹ï¼Œå„˜ç®¡å­˜åœ¨å­£ç¯€æ€§æ³¢å‹•ï¼ŒAlo Yogaçš„ç‘œçˆç”¢å“æ•¸é‡åœ¨éå»ä¸‰å¹´ä¸­å‘ˆç¾å‡ºè¼ƒç‚ºæ˜é¡¯çš„æ“´å¤§è¶¨å‹¢ï¼Œå°¤å…¶æ˜¯åœ¨2024å¹´å‰å¾Œçš„åå½ˆï¼Œæ˜ç¢ºé¡¯ç¤ºå…¬å¸æŒçºŒæ“´å¤§å…¶ç‘œçˆé¡å•†å“ç·šã€‚

æ­¤å¤–ï¼Œæ ¹æ“šè¿‘æœŸçš„è¡Œæ¥­è¶¨å‹¢ï¼Œå“ç‰ŒæŒçºŒæ¨å‹•ç”¢å“å¤šæ¨£åŒ–èˆ‡æ–°ææ–™çš„æ‡‰ç”¨ï¼Œä»¥ç¬¦åˆå¸‚å ´å°æ–¼å°ˆæ¥­ã€ç’°ä¿èˆ‡å‰µæ–°ç”¢å“çš„éœ€æ±‚ï¼Œé€™ä¹Ÿæ˜¯Alo YogaæŒçºŒæ“´å±•çš„å‹•åŠ›ä¹‹ä¸€ã€‚

ç›¸ä¿¡æ­¤åˆ†æèƒ½å¹«åŠ©ç­è§£Alo Yogaåœ¨ç‘œçˆç”¢å“ç·šçš„ç™¼å±•ç‹€æ³èˆ‡æœªä¾†æˆé•·æ½›åŠ›ã€‚

è‹¥éœ€æ›´è©³ç›¡çš„è¡Œæ¥­ç™¼å±•èˆ‡å‰µæ–°è³‡è¨Šï¼ŒWTiNçš„ç›¸é—œæ–‡ç« ä¹Ÿæåˆ°ï¼Œå“ç‰Œæ­£ç©æ¥µçµåˆæ–°ææ–™èˆ‡å¯æŒçºŒæŠ€è¡“ï¼Œæ¨å‹•ç”¢å“é©æ–°ï¼Œé€™åœ¨ç‘œçˆå“ç‰Œä¸­äº¦æ˜¯é‡è¦çš„è¶¨å‹¢ä¹‹ä¸€ã€‚

æ­¤è¨Šæ¯ä¹‹é¸æ“‡ï¼Œæ˜¯å› ç‚ºå®ƒå¯ä»¥è£œå……æˆ‘å€‘å°å¸‚å ´è¶¨å‹¢çš„ç†è§£ï¼Œä¸¦èˆ‡Alo Yogaçš„æ“´å¼µç­–ç•¥ç›¸å‘¼æ‡‰ã€‚`;
              container.appendChild(systemBubble);

              const chartBubble1 = document.createElement('div');
              chartBubble1.className = 'self-start bg-gray-50 text-left rounded-lg px-4 py-2 max-w-[80%] mt-2';
              chartBubble1.innerHTML = `
                <div class="mb-2 font-semibold">åˆ†æï¼š</div>
                <div class="text-sm mb-2">2022 å¹´è‡³ 2024 å¹´æœŸé–“ï¼ŒAlo Yoga ç‘œçˆé¡ç”¢å“çš„å•†å“æ•¸é‡ç¶“æ­·æ³¢å‹•ã€‚2022 å¹´åˆå•†å“æ•¸é‡è¼ƒé«˜ï¼Œ1 æœˆé”åˆ° 292 ä»¶ï¼Œå è©²æœˆç¸½å•†å“æ•¸ 814 ä»¶çš„ 35.9%ã€‚æ­¤å¾Œæ•¸é‡å‘ˆç¾ä¸‹é™è¶¨å‹¢ï¼Œè‡³ 2022 å¹´ 4 æœˆé™è‡³ 7 ä»¶ï¼Œä½†åœ¨ 2022 å¹´ 5 æœˆé–‹å§‹é€æ­¥å›å‡ï¼Œ6 æœˆé”åˆ° 78 ä»¶ã€‚2022 å¹´ 11 æœˆå•†å“æ•¸é‡é”åˆ°æœ€å¤§å€¼ 106 ä»¶ï¼ˆç•¶æœˆç¸½æ•¸ 321 ä»¶ï¼Œå æ¯” 33.0%ï¼‰ï¼Œé¡¯ç¤ºè©²æœˆå“ç‰Œåœ¨ç‘œçˆç”¢å“ä¸Šæœ‰è¼ƒå¤šä¸Šæ¶ã€‚

2023 å¹´èµ·ï¼Œå•†å“æ•¸é‡èµ·ä¼è¼ƒç‚ºæ˜é¡¯ï¼Œå…¶ä¸­ 2023 å¹´ 7 æœˆå•†å“æ•¸é‡ç‚º 66 ä»¶ï¼Œç‚ºåŒæœŸè¼ƒé«˜å€¼ã€‚2024 å¹´å•†å“æ•¸é‡å†åº¦é¡¯è‘—å¢åŠ ï¼Œ9 æœˆé”åˆ° 100 ä»¶ï¼Œå è©²æœˆç¸½æ•¸ 392 ä»¶çš„ 25.5%ã€‚æ•´é«”ä¾†çœ‹ï¼Œå•†å“æ•¸é‡åœ¨ 2022 å¹´åˆè¼ƒé«˜ï¼Œä¹‹å¾Œç¶“æ­·çŸ­æš«ä¸‹é™ï¼Œä½†åœ¨ 2023 å¹´å¾Œé€æ­¥å›å‡ä¸¦æ–¼ 2024 å¹´é”åˆ°è¼ƒé«˜æ°´æº–ï¼Œå‘ˆç¾é€æ­¥æ“´å¤§çš„è¶¨å‹¢ã€‚</div>
                <img src="/static/images/alo_chart_sample.png" alt="Alo Yoga è¶¨å‹¢åœ–" class="rounded border border-gray-300" />
              `;
              container.appendChild(chartBubble1);
              // ç¶å®šåœ–ç‰‡æ”¾å¤§
              const img1 = chartBubble1.querySelector('img');
              if (img1) enableZoom(img1);
              insertButtonRow(container, chartBubble1);

              // --- æ–°å¯¦ä½œï¼šå»ºç«‹ chartBubble2 ---
              const chartBubble2 = document.createElement('div');
              chartBubble2.className = 'self-start bg-gray-50 text-left rounded-lg px-4 py-2 max-w-[80%] mt-2';

              // å»ºç«‹åˆ†ææ®µè½
              const analysisText = document.createElement('div');
              analysisText.className = 'text-sm mb-2';
              analysisText.innerText = '2024 å¹´å…±ä¸Šæ¶ 214 ä»¶ Alo Yoga ç‘œçˆé¡ç”¢å“ã€‚ç”·æ€§æ¬¾ï¼ˆmenï¼‰ä½” 54 ä»¶ï¼Œæ¯”ä¾‹ 25.23%ï¼›å¥³æ€§æ¬¾ï¼ˆwomenï¼‰ä½” 160 ä»¶ï¼Œæ¯”ä¾‹ 74.77%ã€‚å¥³æ€§ç”¢å“åœ¨æ•´é«”ä¸­ä½”è¼ƒå¤§æ¯”ä¾‹ï¼Œåæ˜ å“ç‰Œåœ¨ç”¢å“é–‹ç™¼ä¸Šè¼ƒåé‡å¥³æ€§å¸‚å ´ã€‚';

              // å»ºç«‹åœ–ç‰‡
              const img2 = document.createElement('img');
              img2.src = '/static/images/alo2_chart_sample.png';
              img2.alt = 'Alo Yoga ç´°åˆ†é¡åˆ¥';
              img2.className = 'rounded border border-gray-300 mb-2';
              enableZoom(img2);       // ğŸ‘ˆ é€™è¡Œæ˜¯é—œéµ

              // å»ºç«‹æŒ‰éˆ•
              const toggleButton = document.createElement('button');
              toggleButton.className = 'text-blue-600 text-sm underline hover:text-blue-800 mb-2';
              toggleButton.innerText = 'é¡¯ç¤ºè©³ç´°è¡¨æ ¼';

              // å»ºç«‹è¡¨æ ¼å®¹å™¨
              const tableWrapper = document.createElement('div');
              tableWrapper.className = 'hidden';

              tableWrapper.innerHTML = `
                <div class="mb-2 font-semibold">2024 Alo Yoga ç‘œçˆç”¢å“æ€§åˆ¥åˆ†å¸ƒ</div>
                <table class="markdown-table">
                  <thead>
                    <tr><th>æ€§åˆ¥</th><th>æ•¸é‡</th><th>ç™¾åˆ†æ¯”</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>Men</td><td>54</td><td>25.23%</td></tr>
                    <tr><td>Women</td><td>160</td><td>74.77%</td></tr>
                  </tbody>
                </table>
              `;

              // é»æ“Šäº‹ä»¶åˆ‡æ› hidden é¡
              toggleButton.addEventListener('click', () => {
                tableWrapper.classList.toggle('hidden');
                toggleButton.innerText = tableWrapper.classList.contains('hidden') ? 'é¡¯ç¤ºè©³ç´°è¡¨æ ¼' : 'éš±è—è©³ç´°è¡¨æ ¼';
              });

              // æ’å…¥æ‰€æœ‰å…§å®¹
              chartBubble2.innerHTML = `<div class="mb-2 font-semibold">åˆ†æï¼š</div>`;
              chartBubble2.appendChild(analysisText);
              chartBubble2.appendChild(img2);
              chartBubble2.appendChild(toggleButton);
              chartBubble2.appendChild(tableWrapper);
              container.appendChild(chartBubble2);
              insertButtonRow(container, chartBubble2);
              break;
            }
          case 'MOCK_ANALYSIS_ADIDAS_CHART':
            {
              // ç³»çµ±èªªæ˜æ³¡æ³¡
              const systemBubble = document.createElement('div');
              systemBubble.className = 'self-start bg-gray-200 text-left rounded-lg px-4 py-2 max-w-[80%]';
              systemBubble.innerText = 'ä»¥ä¸‹æ˜¯æ ¹æ“šæ‚¨çš„å•é¡Œæ‰€ç”¢ç”Ÿçš„åˆ†æçµæœï¼š';
              container.appendChild(systemBubble);

              const chartBubble = document.createElement('div');
              chartBubble.className = 'self-start bg-gray-50 text-left rounded-lg px-4 py-2 max-w-[80%] mt-2';
              chartBubble.innerHTML = `
                <div class="mb-2 font-semibold">åˆ†æï¼š</div>
                <div class="text-sm mb-2">ä¸‹åœ–é¡¯ç¤º adidas ä¸åŒé‹å‹•é¡åˆ¥çš„å•†å“æ•¸é‡åˆ†ä½ˆã€‚</div>
                <img src="/static/images/chart_sample.png" alt="adidas å•†å“æ•¸é‡åˆ†ä½ˆ" class="rounded border border-gray-300" />
                `;
              container.appendChild(chartBubble);
              // ç¶å®šåœ–ç‰‡æ”¾å¤§
              const img = chartBubble.querySelector('img');
              if (img) enableZoom(img);
              insertButtonRow(container, chartBubble);
              break;
            }
          case 'MOCK_ANALYSIS_DEFAULT':
            {
              // ç³»çµ±èªªæ˜æ³¡æ³¡
              const systemBubble = document.createElement('div');
              systemBubble.className = 'self-start bg-gray-200 text-left rounded-lg px-4 py-2 max-w-[80%]';
              systemBubble.innerText = 'ä»¥ä¸‹æ˜¯æ ¹æ“šæ‚¨çš„å•é¡Œæ‰€ç”¢ç”Ÿçš„åˆ†æçµæœï¼š';
              container.appendChild(systemBubble);

              const chartBubble = document.createElement('div');
              chartBubble.className = 'self-start bg-gray-50 text-left rounded-lg px-4 py-2 max-w-[80%] mt-2';
              chartBubble.innerHTML = `
                <div class="mb-2 font-semibold">ç¯„ä¾‹åœ–è¡¨åˆ†æ</div>
                <div class="text-sm mb-2">ç¤ºæ„åœ–é¡¯ç¤ºè³‡æ–™åˆ†å¸ƒæƒ…æ³ã€‚</div>
                <img src="/static/images/chart_sample.png" alt="ç¯„ä¾‹åœ–è¡¨" class="rounded border border-gray-300" />
              `;
              container.appendChild(chartBubble);
              // ç¶å®šåœ–ç‰‡æ”¾å¤§
              const img = chartBubble.querySelector('img');
              if (img) enableZoom(img);
              insertButtonRow(container, chartBubble);
              break;
            }
          default:
            {
              bubble.innerText = text;
              container.appendChild(bubble);
              insertButtonRow(container, bubble);
              break;
            }
        }
      }
      container.scrollTop = container.scrollHeight;
    }

    // æ’å…¥ assistant/system å›è¦†çš„æŒ‰éˆ•åˆ—
    // æ–°å¢ systemBubble åƒæ•¸ï¼ˆå¯ç‚º undefinedï¼‰
    function insertButtonRow(container, chartBubble2, systemBubble) {
      // åˆ¤æ–·æ˜¯å¦åƒ…å­˜åœ¨ systemBubble è€Œä¸å­˜åœ¨ä»»ä½• chartBubble
      const messageWrapper = systemBubble ? systemBubble.parentElement : null;
      const hasOnlySystemBubble = systemBubble && messageWrapper && !messageWrapper.querySelector('.chart-bubble') && !messageWrapper.querySelector('.bg-gray-50');

      // å»ºç«‹æŒ‰éˆ•
      const copyButton = document.createElement('button');
      copyButton.innerText = 'è¤‡è£½';
      copyButton.className = 'text-sm px-2 py-1 rounded hover:bg-gray-200';
      if (systemBubble) {
        copyButton.addEventListener('click', () => {
          navigator.clipboard.writeText(systemBubble.innerText);
        });
      } else if (chartBubble2) {
        copyButton.addEventListener('click', () => {
          navigator.clipboard.writeText(chartBubble2.innerText || chartBubble2.textContent);
        });
      }

      const noteButton = document.createElement('button');
      noteButton.innerText = 'å„²å­˜ç­†è¨˜';
      noteButton.className = 'text-sm px-2 py-1 rounded hover:bg-gray-200';

      const buttonWrapper = document.createElement('div');
      buttonWrapper.className = 'flex gap-2 mt-2';
      buttonWrapper.appendChild(copyButton);
      buttonWrapper.appendChild(noteButton);

      // è‹¥åªæœ‰ systemBubble ä¸”æ²’æœ‰ä»»ä½• chart-bubble
      if (hasOnlySystemBubble) {
        // åƒ…è¤‡è£½+ç­†è¨˜
        messageWrapper && messageWrapper.appendChild(buttonWrapper);
        return;
      }

      // è‹¥æœ‰ systemBubble ä½†ä¹Ÿæœ‰ chart-bubbleï¼Œå‰‡å¤šä¸€å€‹ä¸‹è¼‰æŒ‰éˆ•
      if (systemBubble) {
        const downloadButton = document.createElement('button');
        downloadButton.innerText = 'ä¸‹è¼‰åœ–ç‰‡';
        downloadButton.className = 'text-sm px-2 py-1 rounded hover:bg-gray-200';
        buttonWrapper.appendChild(downloadButton);
        messageWrapper && messageWrapper.appendChild(buttonWrapper);
        return;
      }

      // è‹¥æ²’æœ‰ systemBubbleï¼Œåƒ…é‡å° chartBubble2
      if (chartBubble2) {
        const downloadButton = document.createElement('button');
        downloadButton.innerText = 'ä¸‹è¼‰åœ–ç‰‡';
        downloadButton.className = 'text-sm px-2 py-1 rounded hover:bg-gray-200';
        buttonWrapper.appendChild(downloadButton);
        chartBubble2.parentElement && chartBubble2.parentElement.appendChild(buttonWrapper);
        return;
      }
    }

  function enableZoom(img) {
    img.classList.add('zoomable-img');
    img.addEventListener('click', () => {
      const overlay = document.createElement('div');
      overlay.className = 'zoom-overlay';
      const zoomedImg = document.createElement('img');
      zoomedImg.src = img.src;
      overlay.appendChild(zoomedImg);
      overlay.addEventListener('click', () => overlay.remove());
      document.body.appendChild(overlay);
    });
  }

    // æ¨è–¦å•é¡Œå¡ç‰‡é»æ“Šäº‹ä»¶é‡æ§‹ï¼Œç¢ºä¿ä¾éœ€æ±‚è§¸ç™¼æ–¼ DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
      document.querySelectorAll('.question-card').forEach(card => {
        let clicked = false;
        card.addEventListener('click', async () => {
          if (clicked) return;
          clicked = true;
          const userInput = card.textContent.trim();

          // é¡¯ç¤ºä½¿ç”¨è€…è¨Šæ¯
          appendMessage('user', userInput);

          // éš±è—æ¨è–¦å¡ç‰‡åŠæ¨™é¡Œ
          document.getElementById('recommendation-section').style.display = 'none';
          document.getElementById('main-title')?.classList.add('hidden');
          document.getElementById('sub-title')?.classList.add('hidden');

          // é¡¯ç¤º loading
          showTypingAnimation();

          // ç­‰å¾…1ç§’æ¨¡æ“¬å›è¦†æ™‚é–“
          await new Promise(resolve => setTimeout(resolve, 1000));

          // æ ¹æ“šè¼¸å…¥æ±ºå®šå›è¦†å…§å®¹
          if (userInput.includes('Nike')) {
            appendMessage('assistant', 'MOCK_ANALYSIS_1');
          } else if (userInput.includes('Under Armour')) {
            appendMessage('assistant', 'MOCK_ANALYSIS_UA_CHART');
          } else if (userInput.includes('Alo Yoga')) {
            appendMessage('assistant', 'MOCK_ANALYSIS_ALO_CHART');
          } else if (userInput.includes('adidas')) {
            appendMessage('assistant', 'MOCK_ANALYSIS_ADIDAS_CHART');
          } else {
            appendMessage('assistant', 'MOCK_ANALYSIS_DEFAULT');
          }

          // éš±è— loading
          hideTypingAnimation();
        }, { once: true });
      });
    });
  </script>
</body>
</html>